<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>NFC 100₽</title>
<style>
  body{margin:0;height:100vh;background:#000;overflow:hidden;display:flex;justify-content:center;align-items:center;}
  #msg{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Courier New',monospace;font-size:15vw;color:#0f0;opacity:0;transition:opacity .3s;}
  input{position:absolute;opacity:0;pointer-events:none;}
  .green flash{animation:flash-green 1.5s;}
  .red flash{animation:flash-red 2s;}
  @keyframes flash-green{background:#003300;opacity:1;}
  @keyframes flash-red{background:#330000;opacity:1;}
</style>
</head>
<body>

<div id="msg"></div>
<input type="text" id="pin" autofocus>

<audio id="beep" src="https://cdn.jsdelivr.net/gh/nfc-tools/nfc-stealth-terminal@main/beep.mp3"></audio>
<audio id="ok"   src="https://cdn.jsdelivr.net/gh/nfc-tools/nfc-stealth-terminal@main/ok.mp3"></audio>
<audio id="err"  src="https://cdn.jsdelivr.net/gh/nfc-tools/nfc-stealth-terminal@main/err.mp3"></audio>

<script>
const msg  = document.getElementById('msg');
const pin  = document.getElementById('pin');
const beep = document.getElementById('beep');
const ok   = document.getElementById('ok');
const err  = document.getElementById('err');

const PIN = '1010';
let buffer = '';

if ('NDEFReader' in window) {
  const ndef = new NDEFReader();
  ndef.scan();

  ndef.onreading = () => {
    beep.currentTime = 0;
    beep.play();
    pin.focus();
    buffer = '';
  };
}

pin.addEventListener('input', () => {
  buffer += pin.value;
  pin.value = '';
  
  if (buffer.length === 4) {
    if (buffer === PIN) {
      document.body.style.background = '#003300';
      msg.textContent = 'СПИСАНО 100 ₽';
      msg.style.opacity = 1;
      ok.play();
      navigator.vibrate([200,100,200]);
      setTimeout(reset, 2000);
    } else {
      document.body.style.background = '#330000';
      msg.textContent = 'ОТКАЗ';
      msg.style.opacity = 1;
      err.play();
      navigator.vibrate(800);
      setTimeout(reset, 2000);
    }
    buffer = '';
  }
});

function reset() {
  document.body.style.background = '#000';
  msg.style.opacity = 0;
  msg.textContent = '';
}
</script>
</body>
</html>
